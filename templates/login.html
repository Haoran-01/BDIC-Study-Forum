<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CyanPine</title>
    <link href="{{ url_for('static', filename = 'css/login.css') }}" rel="stylesheet" type="text/css"/>
</head>
<body>
    <header>

    </header>
    <video id="backgroundVideo" autoplay loop muted>
        <source src="../static/videos/background_video.mp4" type="video/mp4">
    </video>
    <div class="main">

        <div class="logo">
            <img src="{{ url_for('static', filename = 'images/logo_full.png') }}" alt="logo">
        </div>

        <!--------signUp区域---------------------------------------------------------------------------------------->
        <div class="signUp", id="signUp">
            <form action="{{ url_for("User.register_check") }}" method="post" class="signUpInputArea" novalidate onsubmit="checkSignUp()">
                <input class="mail" id="mailSignUp" name="user_email" type="email" required placeholder="Enter e-mail address" onblur="checkEmail('mailSignUp', 'signUpSubmit')" onfocus="resetInput('mailSignUp')">
                <div class="letter"></div>
                <input type="text" id = "nameSignUp" name="user_name" required onfocus="resetInput('nameSignUp')" placeholder="Enter username">
                <div class="user"></div>
                <input class="password" id = "signUpPass" name="user_password" type="password" required placeholder="Password" onfocus="resetInput('signUpPass')">
                <div class="key1"></div>
                <div class="togglePassword" id="signUpToggle1"></div>
                <input class="password" id = "signUpPassRe" name="confirm" type="password" required placeholder="Confirm" onblur="checkPass()" onfocus="resetInput('signUpPassRe')">
                <div class="key2"></div>
                <div class="togglePassword" id="signUpToggle2"></div>
                <div id="verificationBox">
                    <input class="identify" id = "identifier" name="captcha" type="text" required placeholder="Enter captcha" onfocus="resetInput('identifier')">
                    <button type="button" id="verificationCode" class="verificationCode"></button>
                </div>
                <button type="submit" class = "submit" id="signUpSubmit" onmousedown="checkSignUp()">Sign Up</button>
                <div id="rightToLogin" class="rightArrow" onclick="rightToLogin()" title="Back to login in"></div>
            </form>
        </div>
        <!--------login区域---------------------------------------------------------------------------------------->
        <div class="login" id = "login">
            <div class="slogan">
                <div>The forum for BDICers to discuss and the</div>
                <div>comprehensive services provider for</div>
                <div>BDICers to collect information</div>
            </div>

            <form action="{{ url_for("User.login_check") }}" method="post" class="logInInputArea" novalidate onsubmit="checkLogin()">
                <input id = "mailLogin" name="user_email" type="email" required onblur="checkEmail('mailLogin')" onfocus="resetInput('mailLogin')">
                <div class="letter"></div>
                <input class="password" id = "password" name="user_password" type="password" required onfocus="resetInput('password')">
                <div class="key"></div>
                <div class="togglePassword" id="togglePassword"></div>
                <button type="submit" class = "submit" id = "submitLogin" name="sign_up" value="True">Login</button>
            </form>

            <div id="forgetHr"></div>
            <button id="signUpButton" class="buttonNotObviously" onclick="register()">Sign up</button>
            <button id="forgetPassButton" class="buttonNotObviously" onclick="forgetPass()">Forgot password?</button>
        </div>
        <!--------forgetPassword区域------------------------------------------------------------------------------->
        <div class="forgetPassword", id="forgetPassword">
            <form action="{{ url_for("User.login") }}" method="post" class="forgetPassInputArea" novalidate onsubmit="checkForgetPass()">
                <div class="forgetTitle">Find your account</div>
                <div class="forgetWords">Enter your email to continue:</div>
                <input class="mailConfig" type="email" id="forgetMail" name="user_email" placeholder='Enter e-mail address' required onblur="checkEmail('forgetMail', 'forgetPassSubmit')" onfocus="resetInput('forgetMail')">
                <div class="letter"></div>
                <button type="submit" class = "submit" id = "forgetPassSubmit">Next</button>
                <div id="leftToLogin" class="leftArrow" onclick="leftToLogin()" title="Back to login in"></div>
            </form>
        </div>

    </div>
    <footer>
        <span class="copyright">Copyright@Group 12</span>
    </footer>

    <script>
        /*三个区域的动效**********************************************************************************************/
        var login = document.getElementById("login");
        var signUp = document.getElementById("signUp");
        var forgetPassword =document.getElementById("forgetPassword");

        function register() {
            login.style.left = "450px";
            signUp.style.left = "0px";
        }

        function forgetPass() {
            login.style.left = "-450px";
            forgetPassword.style.left = "0px";
        }

        function rightToLogin() {
            login.style.left = "0px";
            signUp.style.left = "-450px"
        }

        function leftToLogin() {
            login.style.left = "0px";
            forgetPassword.style.left = "450px";
        }
        /*验证码获取按钮**********************************************************************************************/
       var button = document.getElementById('verificationCode');
        button.innerHTML = 'get';
       button.onclick = function () {
            button.disabled = 'disabled';
            button.classList.remove('verificationCode');
            button.classList.add('verificationCodeDisabled');
            var time = 60;
            var timer = setInterval(function () {
                if (time === 0) {
                    clearInterval(timer)
                    button.disabled = '';
                    button.innerHTML = 'get';
                    button.classList.remove('verificationCodeDisabled');
                    button.classList.add('verificationCode');
                } else {
                    time--;
                    button.innerHTML = time + 's';
                }
            }, 1000)
        }

        /*显示隐藏密码按钮**********************************************************************************************/
        let togglePassword0 = document.getElementById("togglePassword");
        let togglePassword1 = document.getElementById("signUpToggle1");
        let togglePassword2 = document.getElementById("signUpToggle2");
        const togglePasswords = Array(togglePassword0, togglePassword1, togglePassword2);
        let password0 = document.getElementById("password");
        let signUpPass = document.getElementById("signUpPass");
        let signUpPassRe = document.getElementById("signUpPassRe");
        const passwords = Array(password0, signUpPass, signUpPassRe);
        for (var i = 0, len = passwords.length; i < len; i = i + 1){
            let password = passwords[i];
            let togglePassword = togglePasswords[i];
            togglePassword.addEventListener('mousedown', function (e){
                e.preventDefault();
                if (password.type === 'password'){
                    password.setAttribute('type', 'text');
                    togglePassword.style.backgroundImage = 'url("images/eye_close.png")';
                    togglePassword.style.bottom = "100px";
                }else{
                    password.setAttribute('type', 'password');
                    togglePassword.style.backgroundImage = 'url("images/eye_open.png")';
                    togglePassword.style.bottom = "103px";
                }
            })
        }

        /*验证用户输入**********************************************************************************************/
        function checkEmail(id, button) {
            var tester = /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/
            if (!tester.test(document.getElementById(id).value)){
                document.getElementById(id).value = "";
                document.getElementById(id).style.borderBottom = '1px solid #ff6d6d';
                document.getElementById(id).style.animation = 'rock 1s 0s ease-in-out';
                document.getElementById(id).setAttribute('placeHolder', 'Invalid email');
            }
        }

        function checkPass() {
            if (signUpPass.value !== signUpPassRe.value){
                signUpPass.style.animation = 'rock 1s 0s ease-in-out';
                signUpPassRe.style.animation = 'rock 1s 0s ease-in-out';
                signUpPass.style.borderBottom = '1px solid #ff6d6d';
                signUpPassRe.style.borderBottom = '1px solid #ff6d6d';
                signUpPass.value = '';
                signUpPassRe.value = '';
            }
        }

        function resetInput(id){
            document.getElementById(id).style = '';
            if (document.getElementById(id).type === 'email'){
                if (id === 'mailLogin'){
                    document.getElementById(id).setAttribute('placeHolder', '');
                }else {
                    document.getElementById(id).setAttribute('placeHolder', 'Enter e-mail address');
                }
            }
        }

        function checkSignUp(){
            let idList = ['mailSignUp', 'nameSignUp', 'signUpPass', 'signUpPassRe', 'identifier'];
            for (var i = 0; i < idList.length; i++){
                if (document.getElementById(idList[i]).value === ''){
                    document.getElementById(idList[i]).style.borderBottom = '1px solid #ff6d6d';
                }
            }
            if (document.getElementById('mailSignUp').value === '' || document.getElementById('nameSignUp').value === '' || signUpPass.value === '' || signUpPassRe.value === '' || document.getElementById('identifier').value === ''){
                event.preventDefault();
            }
        }

        function checkLogin(){
            if (document.getElementById('mailLogin').value === ''){
                document.getElementById('mailLogin').style.borderBottom = '1px solid #ff6d6d';
            }
            if (document.getElementById('password').value === ''){
                document.getElementById('password').style.borderBottom = '1px solid #ff6d6d';
            }
            if (document.getElementById('mailLogin').value === '' || document.getElementById('password').value === ''){
                event.preventDefault();
            }
        }

        function checkForgetPass(){
            if (document.getElementById('forgetMail').value === ''){
                document.getElementById('forgetMail').style.borderBottom = '1px solid #ff6d6d';
                event.preventDefault();
            }
        }
    </script>
</body>
</html>